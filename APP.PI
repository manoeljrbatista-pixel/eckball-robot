import requests
import time

TELEGRAM_TOKEN = "8444535511:AAEzLtv0sFRyBLEB3l0CqJflRwtEu0Vta_0"
CHAT_ID = "7040320123"
API_KEY = "6a677b9f3f89cb6649ba2f02a4d2772c"

BASE_URL = "https://v3.football.api-sports.io"

headers = {
    "x-apisports-key": API_KEY
}

jogos_alertados = set()

def enviar_telegram(mensagem):
    url = f"https://api.telegram.org/bot{TELEGRAM_TOKEN}/sendMessage"
    payload = {
        "chat_id": CHAT_ID,
        "text": mensagem
    }
    requests.post(url, data=payload)

def verificar_jogos():
    url = f"{BASE_URL}/fixtures?live=all"
    response = requests.get(url, headers=headers)
    data = response.json()

    if "response" not in data:
        return

    for jogo in data["response"]:
        fixture_id = jogo["fixture"]["id"]

        if fixture_id in jogos_alertados:
            continue

        minuto = jogo["fixture"]["status"]["elapsed"]
        if not minuto:
            continue

        if not ((28 <= minuto <= 35) or (68 <= minuto <= 78)):
            continue

        stats_url = f"{BASE_URL}/fixtures/statistics?fixture={fixture_id}"
        stats_resp = requests.get(stats_url, headers=headers)
        stats_data = stats_resp.json()

        try:
            stats = stats_data["response"]

            total_corners = 0
            ataques_perigosos = 0
            posse = 0
            finalizacoes = 0

            for team in stats:
                for item in team["statistics"]:
                    if item["type"] == "Corner Kicks":
                        total_corners += int(item["value"] or 0)
                    if item["type"] == "Dangerous Attacks":
                        ataques_perigosos += int(item["value"] or 0)
                    if item["type"] == "Ball Possession":
                        posse = max(posse, int(item["value"].replace("%","") or 0))
                    if item["type"] == "Total Shots":
                        finalizacoes += int(item["value"] or 0)

            if total_corners >= 5 and ataques_perigosos >= 25 and posse >= 55 and finalizacoes >= 8:

                mensagem = f"""
ğŸš¨ ECKBALL TIPPS â€“ ALERTA AO VIVO

â±ï¸ {minuto}'
ğŸ“Š Escanteios: {total_corners}
ğŸ”¥ Ataques perigosos: {ataques_perigosos}
ğŸ“ˆ Posse dominante: {posse}%

ğŸ¯ Entrada sugerida: Over AsiÃ¡tico
ğŸ’° Stake: 2%
"""

                enviar_telegram(mensagem)
                jogos_alertados.add(fixture_id)

        except:
            continue

while True:
    verificar_jogos()
    time.sleep(120)
